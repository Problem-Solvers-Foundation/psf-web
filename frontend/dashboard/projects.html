<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Manage Projects - Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<script>
  tailwind.config = {
    darkMode: "class",
    theme: {
      extend: {
        colors: {
          primary: "#117dd4",
          "background-light": "#f6f7f8",
          "background-dark": "#101a22",
        },
        fontFamily: { display: ["Inter", "sans-serif"] },
      },
    },
  };
</script>
<link rel="stylesheet" href="../assets/css/custom.css"/>
</head>
<body class="bg-background-light dark:bg-background-dark font-display">

<div class="flex min-h-screen">
  <!-- Sidebar (mesmo do dashboard) -->
  <aside class="w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800">
    <div class="flex flex-col h-full">
      <div class="flex items-center gap-3 p-6 border-b border-gray-200 dark:border-gray-800">
        <svg class="h-8 w-8 text-primary" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path clip-rule="evenodd" d="M12.0799 24L4 19.2479L9.95537 8.75216L18.04 13.4961L18.0446 4H29.9554L29.96 13.4961L38.0446 8.75216L44 19.2479L35.92 24L44 28.7521L38.0446 39.2479L29.96 34.5039L29.9554 44H18.0446L18.04 34.5039L9.95537 39.2479L4 28.7521L12.0799 24Z" fill="currentColor" fill-rule="evenodd"></path>
        </svg>
        <div>
          <h1 class="text-lg font-bold text-gray-900 dark:text-white">PSF</h1>
          <p class="text-xs text-gray-500">Dashboard</p>
        </div>
      </div>
      <nav class="flex-1 p-4 space-y-2">
        <a href="index.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
          </svg>
          Overview
        </a>
        <a href="projects.html" class="flex items-center gap-3 px-4 py-3 rounded-lg bg-primary/10 text-primary font-medium">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
          Projects
        </a>
        <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
          Blog
        </a>
        <a href="#" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800">
          <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
          </svg>
        Volunteers
        </a>
      </nav>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 overflow-auto">
    <!-- Header -->
    <header class="bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-8 py-4">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Manage Projects</h2>
          <p class="text-sm text-gray-500 mt-1">Create, edit, and manage your foundation's projects</p>
        </div>
        <button onclick="showCreateModal()" class="px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary/90">
          + New Project
        </button>
      </div>
    </header>

    <!-- Filters -->
    <div class="p-8 pb-4">
      <div class="flex flex-wrap gap-4 items-center">
        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Filter by:</span>
        
        <!-- Category Filter -->
        <select id="category-filter" onchange="filterProjects()" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300">
          <option value="all">All Categories</option>
          <option value="environment">ğŸŒ± Environment</option>
          <option value="health">â¤ï¸ Health</option>
          <option value="education">ğŸ“š Education</option>
          <option value="cybersecurity">ğŸ”’ Cybersecurity</option>
          <option value="poverty">ğŸ¤ Poverty Alleviation</option>
          <option value="technology">ğŸ’» Technology</option>
          <option value="water">ğŸ’§ Water & Sanitation</option>
          <option value="energy">âš¡ Clean Energy</option>
          <option value="food">ğŸŒ¾ Food Security</option>
          <option value="housing">ğŸ  Housing</option>
          <option value="community">ğŸ‘¥ Community Development</option>
          <option value="women-empowerment">ğŸ‘© Women Empowerment</option>
          <option value="youth-development">ğŸ“ Youth Development</option>
          <option value="other">ğŸ“‹ Other</option>
        </select>

        <!-- Status Filter -->
        <select id="status-filter" onchange="filterProjects()" class="px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300">
          <option value="all">All Status</option>
          <option value="planned">ğŸ“ Planned</option>
          <option value="active">ğŸš€ Active</option>
          <option value="completed">âœ… Completed</option>
          <option value="paused">â¸ï¸ Paused</option>
        </select>

        <!-- Results count -->
        <span id="results-count" class="text-sm text-gray-500 dark:text-gray-400 ml-auto"></span>
      </div>
    </div>

    <!-- Projects List -->
    <div class="px-8 pb-8">
      <div id="projects-list" class="space-y-4">
        <!-- Projects will be loaded here -->
      </div>
    </div>
  </main>
</div>

<!-- Modal for Create/Edit Project -->
<div id="project-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
  <div class="bg-white dark:bg-gray-900 rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <div class="p-6 border-b border-gray-200 dark:border-gray-800">
      <h3 id="modal-title" class="text-xl font-bold text-gray-900 dark:text-white">Create New Project</h3>
    </div>
    
    <form id="project-form" class="p-6 space-y-4">
      <input type="hidden" id="project-id" />
      
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Title *</label>
        <input type="text" id="title" required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Description *</label>
        <textarea id="description" required rows="4" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"></textarea>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category *</label>
          <select id="category" required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary">
            <option value="">Select category</option>
            <option value="water">ğŸ’§ Water & Sanitation</option>
            <option value="health">â¤ï¸ Health</option>
            <option value="education">ğŸ“š Education</option>
            <option value="cybersecurity">ğŸ”’ Cybersecurity</option>
            <option value="technology">ğŸ’» Technology</option>
            <option value="environment">ğŸŒ± Environment</option>
            <option value="food">ğŸŒ¾ Food Security</option>
            <option value="energy">âš¡ Clean Energy</option>
            <option value="poverty">ğŸ¤ Poverty Alleviation</option>
            <option value="housing">ğŸ  Housing</option>
            <option value="community">ğŸ‘¥ Community Development</option>
            <option value="women-empowerment">ğŸ‘© Women Empowerment</option>
            <option value="youth-development">ğŸ“ Youth Development</option>
            <option value="other">ğŸ“‹ Other</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Status *</label>
          <select id="status" required class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary">
            <option value="planned">ğŸ“ Planned</option>
            <option value="active" selected>ğŸš€ Active</option>
            <option value="completed">âœ… Completed</option>
            <option value="paused">â¸ï¸ Paused</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Progress (%)</label>
          <input type="number" id="progress" min="0" max="100" value="0" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
        </div>

        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Completion Date</label>
          <input type="text" id="completionDate" placeholder="Q1 2026" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
        </div>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Image URL</label>
        <input type="url" id="imageUrl" placeholder="https://example.com/image.jpg" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Completion Date</label>
        <input type="text" id="completionDate" placeholder="Q1 2026" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
      </div>
      
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Lives Impacted</label>
          <input type="number" id="livesImpacted" min="0" value="0" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Volunteers Involved</label>
          <input type="number" id="volunteersInvolved" min="0" value="0" class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-primary"/>
        </div>
      </div>
      
      <div class="flex gap-4 pt-4">
        <button type="submit" class="flex-1 px-4 py-2 bg-primary text-white rounded-lg font-medium hover:bg-primary/90">
          Save Project
        </button>
        <button type="button" onclick="closeModal()" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-300 dark:hover:bg-gray-600">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Scripts -->
<script src="../assets/js/config.js"></script>
<script src="../assets/js/utils.js"></script>
<script src="../assets/js/projects.js"></script>

<script>
  let currentFilter = 'all';
  let allProjects = [];

  // Load projects on page load
  document.addEventListener('DOMContentLoaded', () => {
    loadProjects();
  });

  // Load all projects
  async function loadProjects() {
    Utils.showLoading('projects-list');
    
    try {
      const response = await ProjectsAPI.getAll();
      
      if (!response.success || !response.data) {
        Utils.showError('projects-list');
        return;
      }
      
      allProjects = response.data;
      displayProjects(allProjects);
      
    } catch (error) {
      console.error('Error loading projects:', error);
      Utils.showError('projects-list');
    }
  }

  // Display projects
  function displayProjects(projects) {
    const container = document.getElementById('projects-list');
    
    if (projects.length === 0) {
      Utils.showEmptyState('projects-list', 'No projects found');
      return;
    }
    
    const html = projects.map(project => `
      <div class="bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-800 p-6 hover:shadow-lg transition-shadow">
        <div class="flex items-start justify-between">
          <div class="flex gap-4 flex-1">
            <img src="${project.imageUrl || 'https://via.placeholder.com/80'}" 
                 alt="${project.title}" 
                 class="w-20 h-20 rounded-lg object-cover"
                 onerror="this.src='https://via.placeholder.com/80'"/>
            <div class="flex-1">
              <h3 class="text-lg font-bold text-gray-900 dark:text-white">${project.title}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">${Utils.truncateText(project.description, 100)}</p>
              <div class="flex items-center gap-3 mt-3">
                <span class="px-2 py-1 rounded text-xs font-medium bg-${getCategoryColor(project.category)}-100 text-${getCategoryColor(project.category)}-800">
                  ${project.category}
                </span>
                <span class="text-xs text-gray-500">${project.completionDate || 'No deadline'}</span>
              </div>
            </div>
          </div>
          
          <div class="flex gap-2">
            <button onclick="editProject('${project.id}')" class="p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg" title="Edit">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
            </button>
            <button onclick="deleteProject('${project.id}', '${project.title}')" class="p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg" title="Delete">
              <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
              </svg>
            </button>
          </div>
        </div>
        
        <div class="mt-4">
          <div class="flex items-center justify-between text-sm mb-2">
            <span class="text-gray-600 dark:text-gray-400">Progress</span>
            <span class="font-bold text-primary">${project.progress}%</span>
          </div>
          <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div class="h-full bg-primary rounded-full" style="width: ${project.progress}%"></div>
          </div>
        </div>
        
        ${project.metrics ? `
          <div class="flex gap-4 mt-4 text-sm">
            ${project.metrics.livesImpacted ? `
              <div>
                <span class="text-gray-600 dark:text-gray-400">Lives: </span>
                <span class="font-medium">${Utils.formatNumber(project.metrics.livesImpacted)}</span>
              </div>
            ` : ''}
            ${project.metrics.volunteersInvolved ? `
              <div>
                <span class="text-gray-600 dark:text-gray-400">Volunteers: </span>
                <span class="font-medium">${project.metrics.volunteersInvolved}</span>
              </div>
            ` : ''}
          </div>
        ` : ''}
      </div>
    `).join('');
    
    container.innerHTML = html;
  }

  // Filter projects
  function filterProjects() {
    const categoryFilter = document.getElementById('category-filter').value;
    const statusFilter = document.getElementById('status-filter').value;

    let filtered = allProjects;

    // Filter by category
    if (categoryFilter !== 'all') {
      filtered = filtered.filter(p => p.category === categoryFilter);
    }

    // Filter by status
    if (statusFilter !== 'all') {
      filtered = filtered.filter(p => p.status === statusFilter);
    }

    // Update results count
    const resultsCount = document.getElementById('results-count');
    resultsCount.textContent = `${filtered.length} project${filtered.length !== 1 ? 's' : ''} found`;

    displayProjects(filtered);
  }

  // Show create modal
  function showCreateModal() {
    document.getElementById('modal-title').textContent = 'Create New Project';
    document.getElementById('project-form').reset();
    document.getElementById('project-id').value = '';
    document.getElementById('project-modal').classList.remove('hidden');
  }

  // Edit project
  async function editProject(id) {
    try {
      const response = await ProjectsAPI.getById(id);
      
      if (!response.success || !response.data) {
        alert('Error loading project');
        return;
      }
      
      const project = response.data;
      
      document.getElementById('modal-title').textContent = 'Edit Project';
      document.getElementById('project-id').value = project.id;
      document.getElementById('title').value = project.title;
      document.getElementById('description').value = project.description;
      document.getElementById('category').value = project.category;
      document.getElementById('status').value = project.status || 'active';
      document.getElementById('progress').value = project.progress || 0;
      document.getElementById('imageUrl').value = project.imageUrl || '';
      document.getElementById('completionDate').value = project.completionDate || '';
      document.getElementById('livesImpacted').value = project.metrics?.livesImpacted || 0;
      document.getElementById('volunteersInvolved').value = project.metrics?.volunteersInvolved || 0;
      
      document.getElementById('project-modal').classList.remove('hidden');
      
    } catch (error) {
      console.error('Error loading project:', error);
      alert('Error loading project details');
    }
  }

  // Close modal
  function closeModal() {
    document.getElementById('project-modal').classList.add('hidden');
  }

  // Handle form submission
  document.getElementById('project-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const projectId = document.getElementById('project-id').value;
    const isEdit = !!projectId;
    
    const projectData = {
      title: document.getElementById('title').value,
      description: document.getElementById('description').value,
      category: document.getElementById('category').value,
      status: document.getElementById('status').value,
      progress: parseInt(document.getElementById('progress').value) || 0,
      imageUrl: document.getElementById('imageUrl').value || '',
      completionDate: document.getElementById('completionDate').value || '',
      metrics: {
        livesImpacted: parseInt(document.getElementById('livesImpacted').value) || 0,
        volunteersInvolved: parseInt(document.getElementById('volunteersInvolved').value) || 0
      },
      isPublished: true
    };
    
    try {
      let response;
      
      if (isEdit) {
        response = await ProjectsAPI.update(projectId, projectData);
      } else {
        response = await ProjectsAPI.create(projectData);
      }
      
      if (response.success) {
        alert(isEdit ? 'Project updated successfully!' : 'Project created successfully!');
        closeModal();
        loadProjects();
      } else {
        alert('Error saving project: ' + (response.error || 'Unknown error'));
      }
      
    } catch (error) {
      console.error('Error saving project:', error);
      alert('Error saving project. Please try again.');
    }
  });

  // Delete project
  async function deleteProject(id, title) {
    if (!confirm(`Are you sure you want to delete "${title}"?`)) {
      return;
    }
    
    try {
      const response = await ProjectsAPI.delete(id);
      
      if (response.success) {
        alert('Project deleted successfully!');
        loadProjects();
      } else {
        alert('Error deleting project: ' + (response.error || 'Unknown error'));
      }
      
    } catch (error) {
      console.error('Error deleting project:', error);
      alert('Error deleting project. Please try again.');
    }
  }

  // Helper function for category colors
  function getCategoryColor(category) {
    const colors = {
      water: 'blue',
      health: 'red',
      education: 'purple',
      cybersecurity: 'indigo',
      technology: 'cyan',
      environment: 'green',
      food: 'amber',
      energy: 'yellow',
      poverty: 'orange',
      housing: 'pink',
      community: 'teal',
      'women-empowerment': 'rose',
      'youth-development': 'violet',
      other: 'gray'
    };
    return colors[category] || 'gray';
  }

  // Close modal when clicking outside
  document.getElementById('project-modal').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) {
      closeModal();
    }
  });

  // Close modal with ESC key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeModal();
    }
  });
</script>

</body>
</html>