<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profile - Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#117dd4"
          }
        }
      }
    };
  </script>
  <%- include('../partials/admin-styles') %>
</head>
<body class="bg-gray-50">
  <% const currentPage = 'profile'; %>

  <%- include('../partials/admin-mobile-header') %>

  <% if (user.role === 'user' || (typeof from !== 'undefined' && from === 'community')) { %>
    <%- include('../partials/community-sidebar') %>
  <% } else { %>
    <%- include('../partials/admin-sidebar') %>
  <% } %>

  <!-- Main Content -->
  <div class="lg:ml-64 min-h-screen pt-14 lg:pt-0">
    <!-- Top Bar -->
    <div class="bg-white border-b border-gray-200 px-6 py-4">
      <h2 class="text-2xl font-bold text-gray-900">Edit Profile</h2>
      <p class="text-sm text-gray-600">Update your name and bio</p>
    </div>

    <!-- Page Content -->
    <div class="p-6">
      <div class="max-w-2xl">
        <!-- Success/Error Messages -->
        <% if (success) { %>
          <div class="mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
            <%= success %>
          </div>
        <% } %>

        <% if (error) { %>
          <div class="mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
            <%= error %>
          </div>
        <% } %>

  <!-- Profile Form -->
  <div class="bg-white shadow-sm rounded-lg border border-gray-200">
    <form action="/admin/profile" method="POST" class="p-6">

      <!-- Current User Info -->
      <div class="mb-6 p-4 bg-gray-50 rounded-lg">
        <h3 class="text-lg font-semibold text-gray-900 mb-2">Account Information</h3>
        <div class="space-y-2 text-sm">
          <div>
            <span class="font-medium text-gray-600">Email:</span>
            <span class="text-gray-900"><%= user.email %></span>
          </div>
          <div>
            <span class="font-medium text-gray-600">Role:</span>
            <span class="text-gray-900 capitalize"><%= user.role %></span>
          </div>
        </div>
      </div>

      <!-- Editable Fields -->
      <div class="space-y-6">
        <!-- Name Field -->
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
            Full Name <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="name"
            name="name"
            value="<%= user.name %>"
            required
            minlength="2"
            maxlength="100"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
            placeholder="Enter your full name"
          >
          <p class="mt-1 text-sm text-gray-500">
            This will be displayed throughout the admin panel
          </p>
        </div>

        <!-- Bio Field -->
        <div>
          <label for="bio" class="block text-sm font-medium text-gray-700 mb-2">
            Bio
          </label>
          <textarea
            id="bio"
            name="bio"
            rows="4"
            maxlength="500"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
            placeholder="Tell us a bit about yourself (optional)"
          ><%= user.bio %></textarea>
          <p class="mt-1 text-sm text-gray-500">
            <span id="bioCounter">0</span>/500 characters
          </p>
        </div>

        <!-- PSF Profile Section -->
        <div class="border-t border-gray-200 pt-6 mt-8">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">PSF Profile Information</h3>

          <!-- Basic Information -->
          <div class="mb-6">
            <h4 class="text-md font-medium text-gray-800 mb-4">Basic Information</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                <input type="text" id="firstName" name="firstName" value="<%= user.firstName || '' %>" maxlength="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
              <div>
                <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                <input type="text" id="lastName" name="lastName" value="<%= user.lastName || '' %>" maxlength="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
              <div>
                <label for="linkedinUrl" class="block text-sm font-medium text-gray-700 mb-2">LinkedIn URL</label>
                <input type="url" id="linkedinUrl" name="linkedinUrl" value="<%= user.linkedinUrl || '' %>" placeholder="https://linkedin.com/in/yourprofile" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                <p class="mt-1 text-xs text-gray-500">Must be a valid LinkedIn profile URL</p>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <h5 class="text-sm font-medium text-gray-800 mb-3">Location</h5>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="country" class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                <input type="text" id="country" name="country" value="<%= user.country || '' %>" maxlength="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., United States">
              </div>
              <div>
                <label for="state" class="block text-sm font-medium text-gray-700 mb-2">State</label>
                <input type="text" id="state" name="state" value="<%= user.state || '' %>" maxlength="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., California">
              </div>
              <div>
                <label for="city" class="block text-sm font-medium text-gray-700 mb-2">City</label>
                <input type="text" id="city" name="city" value="<%= user.city || '' %>" maxlength="50" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="e.g., San Francisco">
              </div>
            </div>
          </div>

          <div class="mb-6">
            <label for="introduction" class="block text-sm font-medium text-gray-700 mb-2">Introduce Yourself</label>
            <textarea id="introduction" name="introduction" rows="3" maxlength="1000" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="Share your background, key experiences, and what motivates you as a problem solver"><%= user.introduction || '' %></textarea>
            <p class="mt-1 text-xs text-gray-500">Maximum 1000 characters</p>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="introVideoUrl" class="block text-sm font-medium text-gray-700 mb-2">Introduction Video URL (Optional)</label>
                <input type="url" id="introVideoUrl" name="introVideoUrl" value="<%= user.introVideoUrl || '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
              <div>
                <label for="accomplishment" class="block text-sm font-medium text-gray-700 mb-2">Most Impressive Accomplishment</label>
                <input type="text" id="accomplishment" name="accomplishment" value="<%= user.accomplishment || '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
            </div>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="education" class="block text-sm font-medium text-gray-700 mb-2">Education</label>
                <textarea id="education" name="education" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="Schools, degrees, fields of study, and graduation years"><%= user.education || '' %></textarea>
              </div>
              <div>
                <label for="employmentHistory" class="block text-sm font-medium text-gray-700 mb-2">Employment History</label>
                <textarea id="employmentHistory" name="employmentHistory" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="Organizations, roles/titles, and dates"><%= user.employmentHistory || '' %></textarea>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Are you technical?</label>
                <select id="isTechnical" name="isTechnical" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                  <option value="">Select...</option>
                  <option value="true" <%= (user.isTechnical === true) ? 'selected' : '' %>>Yes</option>
                  <option value="false" <%= (user.isTechnical === false) ? 'selected' : '' %>>No</option>
                </select>
              </div>
              <div>
                <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">Gender</label>
                <input type="text" id="gender" name="gender" value="<%= user.gender || '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
              <div>
                <label for="birthdate" class="block text-sm font-medium text-gray-700 mb-2">Birthdate</label>
                <input type="date" id="birthdate" name="birthdate" value="<%= user.birthdate ? new Date(user.birthdate.seconds * 1000 || user.birthdate).toISOString().split('T')[0] : '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
            </div>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div>
                <label for="schedulingUrl" class="block text-sm font-medium text-gray-700 mb-2">Scheduling URL (Optional)</label>
                <input type="url" id="schedulingUrl" name="schedulingUrl" value="<%= user.schedulingUrl || '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
              <div>
                <label for="twitterUrl" class="block text-sm font-medium text-gray-700 mb-2">Twitter URL (Optional)</label>
                <input type="url" id="twitterUrl" name="twitterUrl" value="<%= user.twitterUrl || '' %>" placeholder="https://twitter.com/username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                <p class="mt-1 text-xs text-gray-500">Must be a valid Twitter/X profile URL</p>
              </div>
              <div>
                <label for="instagramUrl" class="block text-sm font-medium text-gray-700 mb-2">Instagram URL (Optional)</label>
                <input type="url" id="instagramUrl" name="instagramUrl" value="<%= user.instagramUrl || '' %>" placeholder="https://instagram.com/username" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                <p class="mt-1 text-xs text-gray-500">Must be a valid Instagram profile URL</p>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <label for="hearAboutPsf" class="block text-sm font-medium text-gray-700 mb-2">How did you hear about the Problem Solver Foundation?</label>
            <input type="text" id="hearAboutPsf" name="hearAboutPsf" value="<%= user.hearAboutPsf || '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
          </div>
        </div>

        <!-- Projects and Initiatives -->
        <div class="border-t border-gray-200 pt-6 mt-8">
          <h4 class="text-md font-medium text-gray-800 mb-4">Projects and Initiatives</h4>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Do you already have a challenge, initiative, or project you are committed to?</label>
            <select id="hasProject" name="hasProject" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              <option value="">Select...</option>
              <option value="committed" <%= (user.hasProject === 'committed') ? 'selected' : '' %>>Yes, I'm fully committed and looking for collaborators</option>
              <option value="ideas" <%= (user.hasProject === 'ideas') ? 'selected' : '' %>>I have ideas but I'm open to co-creating</option>
              <option value="none" <%= (user.hasProject === 'none') ? 'selected' : '' %>>Not yet â€” I prefer joining an existing challenge or team</option>
            </select>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="projectName" class="block text-sm font-medium text-gray-700 mb-2">Project or Initiative Name</label>
                <input type="text" id="projectName" name="projectName" value="<%= user.projectName || '' %>" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Do you already have collaborators or co-founders?</label>
                <select id="hasCollaborators" name="hasCollaborators" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                  <option value="">Select...</option>
                  <option value="true" <%= (user.hasCollaborators === true) ? 'selected' : '' %>>Yes</option>
                  <option value="false" <%= (user.hasCollaborators === false) ? 'selected' : '' %>>No</option>
                </select>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <label for="projectDescription" class="block text-sm font-medium text-gray-700 mb-2">Describe your project in a few sentences</label>
            <textarea id="projectDescription" name="projectDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"><%= user.projectDescription || '' %></textarea>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="projectProgress" class="block text-sm font-medium text-gray-700 mb-2">Project Progress (Optional)</label>
                <textarea id="projectProgress" name="projectProgress" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="How long have you been working on this, and what progress have you made?"><%= user.projectProgress || '' %></textarea>
              </div>
              <div>
                <label for="projectSupport" class="block text-sm font-medium text-gray-700 mb-2">Project Support (Optional)</label>
                <textarea id="projectSupport" name="projectSupport" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="If you've received support or resources, who contributed and what was provided?"><%= user.projectSupport || '' %></textarea>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">When are you ready to work full-time on this initiative?</label>
            <select id="fullTimeReadiness" name="fullTimeReadiness" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
              <option value="">Select...</option>
              <option value="already" <%= (user.fullTimeReadiness === 'already') ? 'selected' : '' %>>I'm already full-time</option>
              <option value="ready" <%= (user.fullTimeReadiness === 'ready') ? 'selected' : '' %>>I'm ready as soon as I meet the right collaborator</option>
              <option value="within_year" <%= (user.fullTimeReadiness === 'within_year') ? 'selected' : '' %>>I plan to go full-time within the next year</option>
              <option value="no_plans" <%= (user.fullTimeReadiness === 'no_plans') ? 'selected' : '' %>>I don't have specific plans yet</option>
            </select>
          </div>

          <div class="mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="responsibilityAreas" class="block text-sm font-medium text-gray-700 mb-2">Areas You're Willing to Take Responsibility For</label>
                <textarea id="responsibilityAreas" name="responsibilityAreas" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="Separate multiple areas with commas"><%= Array.isArray(user.responsibilityAreas) ? user.responsibilityAreas.join(', ') : (user.responsibilityAreas || '') %></textarea>
              </div>
              <div>
                <label for="interestedTopics" class="block text-sm font-medium text-gray-700 mb-2">Topics or Impact Sectors You're Most Interested In</label>
                <textarea id="interestedTopics" name="interestedTopics" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="Separate multiple topics with commas"><%= Array.isArray(user.interestedTopics) ? user.interestedTopics.join(', ') : (user.interestedTopics || '') %></textarea>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <label for="collaborationExpectations" class="block text-sm font-medium text-gray-700 mb-2">Expectations for Sharing Responsibilities and Impact Ownership</label>
            <textarea id="collaborationExpectations" name="collaborationExpectations" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors" placeholder="What would you offer and what would you expect in return?"><%= user.collaborationExpectations || '' %></textarea>
          </div>
        </div>

        <!-- Motivation, Values, and Personal Background -->
        <div class="border-t border-gray-200 pt-6 mt-8">
          <h4 class="text-md font-medium text-gray-800 mb-4">Motivation, Values, and Personal Background</h4>

          <div class="mb-6">
            <label for="hobbies" class="block text-sm font-medium text-gray-700 mb-2">What do you do in your free time? What are your hobbies and interests?</label>
            <textarea id="hobbies" name="hobbies" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"><%= user.hobbies || '' %></textarea>
          </div>

          <div class="mb-6">
            <label for="lifePath" class="block text-sm font-medium text-gray-700 mb-2">How did your life path lead you to where you are now? How have your experiences shaped your values?</label>
            <textarea id="lifePath" name="lifePath" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"><%= user.lifePath || '' %></textarea>
          </div>

          <div class="mb-6">
            <label for="additionalInfo" class="block text-sm font-medium text-gray-700 mb-2">Is there anything else you would like potential collaborators or the PSF community to know about you?</label>
            <textarea id="additionalInfo" name="additionalInfo" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"><%= user.additionalInfo || '' %></textarea>
          </div>
        </div>

        <!-- Password Change Section -->
        <div class="border-t border-gray-200 pt-6 mt-8">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Change Password</h3>
          <p class="text-sm text-gray-600 mb-6">Leave blank to keep your current password</p>

          <div class="space-y-4">
            <!-- Current Password -->
            <div>
              <label for="currentPassword" class="block text-sm font-medium text-gray-700 mb-2">
                Current Password
              </label>
              <input
                type="password"
                id="currentPassword"
                name="currentPassword"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                placeholder="Enter your current password"
              >
            </div>

            <!-- New Password -->
            <div>
              <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-2">
                New Password
              </label>
              <input
                type="password"
                id="newPassword"
                name="newPassword"
                minlength="6"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                placeholder="Enter new password (minimum 6 characters)"
              >
            </div>

            <!-- Confirm New Password -->
            <div>
              <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700 mb-2">
                Confirm New Password
              </label>
              <input
                type="password"
                id="confirmNewPassword"
                name="confirmNewPassword"
                minlength="6"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                placeholder="Confirm your new password"
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="flex items-center justify-between pt-6 border-t border-gray-200 mt-8">
        <a
          href="/admin/dashboard"
          class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"
        >
          Cancel
        </a>
        <button
          type="submit"
          class="px-6 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary/90 focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"
        >
          Update Profile
        </button>
      </div>
    </form>
  </div>

  <!-- Additional Info -->
  <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
    <div class="flex items-start gap-3">
      <svg class="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div class="text-sm text-blue-800">
        <p class="font-medium mb-1">Note:</p>
        <p>Your email address cannot be changed. If you need to update your email, please contact the administrator.</p>
      </div>
    </div>
  </div>
</div>

<script>
  // Bio character counter
  document.addEventListener('DOMContentLoaded', function() {
    const bioTextarea = document.getElementById('bio');
    const bioCounter = document.getElementById('bioCounter');

    function updateCounter() {
      const length = bioTextarea.value.length;
      bioCounter.textContent = length;

      // Update color based on length
      if (length > 450) {
        bioCounter.style.color = '#dc2626'; // red
      } else if (length > 400) {
        bioCounter.style.color = '#ea580c'; // orange
      } else {
        bioCounter.style.color = '#6b7280'; // gray
      }
    }

    // Initial count
    updateCounter();

    // Update on input
    bioTextarea.addEventListener('input', updateCounter);

    // Password validation
    const currentPassword = document.getElementById('currentPassword');
    const newPassword = document.getElementById('newPassword');
    const confirmNewPassword = document.getElementById('confirmNewPassword');
    const form = document.querySelector('form');

    function validatePasswords() {
      const current = currentPassword.value;
      const newPass = newPassword.value;
      const confirmPass = confirmNewPassword.value;

      // Reset custom validity
      currentPassword.setCustomValidity('');
      newPassword.setCustomValidity('');
      confirmNewPassword.setCustomValidity('');

      // If any password field is filled, all password fields are required
      if (current || newPass || confirmPass) {
        if (!current) {
          currentPassword.setCustomValidity('Current password is required when changing password');
        }
        if (!newPass) {
          newPassword.setCustomValidity('New password is required');
        }
        if (!confirmPass) {
          confirmNewPassword.setCustomValidity('Password confirmation is required');
        }
        if (newPass && confirmPass && newPass !== confirmPass) {
          confirmNewPassword.setCustomValidity('Passwords do not match');
        }
        if (newPass && newPass.length < 6) {
          newPassword.setCustomValidity('Password must be at least 6 characters long');
        }
      }
    }

    // Add event listeners for password validation
    [currentPassword, newPassword, confirmNewPassword].forEach(field => {
      field.addEventListener('input', validatePasswords);
      field.addEventListener('blur', validatePasswords);
    });

    // Validate on form submit
    form.addEventListener('submit', function(e) {
      validatePasswords();
      if (!form.checkValidity()) {
        e.preventDefault();
      }
    });
  });
</script>

      </div>
    </div>
  </div>

  <%- include('../partials/admin-scripts') %>
</body>
</html>