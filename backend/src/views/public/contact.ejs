<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= title %></title>
  <meta name="description" content="<%= description %>">

  <!-- Favicon - Multiple formats for browser compatibility -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon.png">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.png">

  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>tailwind.config={darkMode:"class",theme:{extend:{colors:{"primary":"#117dd4","background-light":"#f6f7f8","background-dark":"#101a22","text-light":"#101a22","text-dark":"#f6f7f8","surface-light":"#ffffff","surface-dark":"#1b2733","border-light":"#e7eef3","border-dark":"#2a3b4c","muted-light":"#4c779a","muted-dark":"#a0b3c4"},fontFamily:{"display":["Inter","sans-serif"]},borderRadius:{"DEFAULT":"0.5rem","lg":"0.75rem","xl":"1rem","full":"9999px"}}}}</script>
  <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-text-light dark:text-text-dark">
  <div class="relative flex h-auto min-h-screen w-full flex-col">
    <div class="layout-container flex h-full grow flex-col">
      <%- include('../partials/header', { currentPage: currentPage }) %>
      <main class="flex-1">
        <div class="container mx-auto px-4 py-12 sm:px-6 lg:px-8 lg:py-24">
          <div class="max-w-2xl mx-auto">
            <div class="text-center mb-12">
              <h2 class="text-3xl font-extrabold tracking-tight sm:text-4xl">Contact Us</h2>
              <p class="mt-4 text-lg text-black/60 dark:text-white/60">Get in touch with us. We'd love to hear from you.</p>
            </div>
            <!-- Success Message -->
            <div id="successMessage" class="hidden mb-6 p-4 bg-green-100 dark:bg-green-900 border border-green-400 dark:border-green-600 text-green-700 dark:text-green-200 rounded-lg">
              <p class="font-semibold">Message sent successfully!</p>
              <p class="text-sm mt-1">Thank you for your message. We will get back to you soon.</p>
            </div>

            <!-- Error Message -->
            <div id="errorMessage" class="hidden mb-6 p-4 bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-600 text-red-700 dark:text-red-200 rounded-lg">
              <p class="font-semibold">Error sending message</p>
              <p id="errorText" class="text-sm mt-1"></p>
            </div>

            <form id="contactForm" class="space-y-6">
              <div>
                <label for="name" class="block text-sm font-medium">Name</label>
                <input type="text" id="name" name="name" class="mt-1 block w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-gray-900 dark:text-white focus:border-primary focus:ring-primary" required minlength="2" maxlength="100">
              </div>
              <div>
                <label for="email" class="block text-sm font-medium">Email</label>
                <input type="email" id="email" name="email" class="mt-1 block w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-gray-900 dark:text-white focus:border-primary focus:ring-primary" required maxlength="254">
              </div>
              <div>
                <label for="message" class="block text-sm font-medium">Message</label>
                <textarea id="message" name="message" rows="6" class="mt-1 block w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-4 py-2 text-gray-900 dark:text-white focus:border-primary focus:ring-primary" required minlength="10" maxlength="5000"></textarea>
              </div>
              <!-- Honeypot field for bot detection (hidden from users) -->
              <input type="text" name="website" id="website" style="display:none" tabindex="-1" autocomplete="off">
              <div>
                <button type="submit" id="submitBtn" class="w-full bg-primary text-white rounded-lg h-12 px-6 text-base font-bold hover:bg-opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                  <span id="submitText">Send Message</span>
                  <span id="loadingText" class="hidden">Sending...</span>
                </button>
              </div>
            </form>

            <script>
              (function() {
                const form = document.getElementById('contactForm');
                const submitBtn = document.getElementById('submitBtn');
                const submitText = document.getElementById('submitText');
                const loadingText = document.getElementById('loadingText');
                const successMessage = document.getElementById('successMessage');
                const errorMessage = document.getElementById('errorMessage');
                const errorText = document.getElementById('errorText');

                form.addEventListener('submit', async function(e) {
                  e.preventDefault();

                  // Hide previous messages
                  successMessage.classList.add('hidden');
                  errorMessage.classList.add('hidden');

                  // Disable submit button
                  submitBtn.disabled = true;
                  submitText.classList.add('hidden');
                  loadingText.classList.remove('hidden');

                  // Get form data
                  const formData = {
                    name: document.getElementById('name').value.trim(),
                    email: document.getElementById('email').value.trim(),
                    message: document.getElementById('message').value.trim(),
                    website: document.getElementById('website').value // Honeypot
                  };

                  try {
                    const response = await fetch('/api/contact/submit', {
                      method: 'POST',
                      headers: {
                        'Content-Type': 'application/json',
                      },
                      body: JSON.stringify(formData)
                    });

                    const data = await response.json();

                    if (response.ok && data.success) {
                      // Show success message
                      successMessage.classList.remove('hidden');
                      // Reset form
                      form.reset();
                      // Scroll to top to show success message
                      successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    } else {
                      // Show error message
                      errorText.textContent = data.message || data.errors?.join(', ') || 'An error occurred. Please try again.';
                      errorMessage.classList.remove('hidden');
                      errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                  } catch (error) {
                    console.error('Error:', error);
                    errorText.textContent = 'Network error. Please check your connection and try again.';
                    errorMessage.classList.remove('hidden');
                    errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  } finally {
                    // Re-enable submit button
                    submitBtn.disabled = false;
                    submitText.classList.remove('hidden');
                    loadingText.classList.add('hidden');
                  }
                });
              })();
            </script>
          </div>
        </div>
      </main>
      <%- include('../partials/footer') %>
    </div>
  </div>
  <%- include('../partials/scripts', { pageScripts: [], inlineScript: null }) %>
</body>
</html>
